## Overview

This is specifically for spinning up 2 ubuntu14.04 instances in csail environment, using my own keypair, the instance has 4G RAM, 32G disk, and 1 core.  
This recipe installs devstack kilo (master branch) with minimal configuration

## Usage 

### 1. Spin up vms and deploy devstack

simply run `vagrant up` 

### 2. ssh in the machine and change files

Follow [rodrigods' tutorial](http://blog.rodrigods.com/it-is-time-to-play-with-keystone-to-keystone-federation-in-kilo/) to set up files in SP and IdP 

In short: 

* SP
  * `/etc/keystone/keystone.conf` `[auth]` section
  * `/etc/apache2/sites-available/keystone.conf` 
  * shibboleth should be installed by vagrant recipe but needs configuration
  * `/etc/shibboleth/attribute-map.xml` attribute names
  * `/etc/shibboleth/shibboleth2.xml` SSO entity ID and MetadataProvider
  * keygen, and restart service

* IdP
  * `/etc/keystone/keystone.conf` `[saml]` section
  * `keystone_idp_metadata.json` should be generated by vagrant recipe
  * restart service 

### 3. Make IdP and SP know each other

**In SP**

in folder `/opt/stack/SP` **change** the `auth_url`, `user_id`, `password`, and `project_id` in `v3.Password` method to match your sp and idp keystone endpoint in your own environment, and then run 

```
python setupk2k_sp.py
```

**In IdP**

in folder `/opt/stack/IdP` **change** the url, user_id, password, and project to match your sp and idp keystone endoints, and then run:

```
python setupk2k_idp.py
```

If everything runs find, run:

```
python k2kclient.py
```

which sets up k2k 

Done


If using an none ubuntu image, change the following line accordingly

```
devstack.ssh.username = 'ubuntu'
```

